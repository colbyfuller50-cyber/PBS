<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Background Check Authorization | Palmetto Background Screening</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  background:#f9f9f9;
  font-family:Arial, sans-serif;
}

.form-container {
  max-width:700px;
  margin:3rem auto;
  background:#fff;
  padding:2.5rem;
  border-radius:10px;
  box-shadow:0 6px 20px rgba(0,0,0,.08);
}

.form-header {
  text-align:center;
  margin-bottom:2rem;
}

.form-header img {
  max-width:200px;
  margin-bottom:1rem;
}

.form-header h1 {
  color:#1b3b1b;
}

.section-title {
  margin-top:2rem;
  color:#1b3b1b;
  font-size:1.2rem;
}

.form-group {
  margin-bottom:1.2rem;
}

.form-group label {
  font-weight:bold;
  display:block;
  margin-bottom:.4rem;
}

.form-group input {
  width:100%;
  padding:.8rem;
  border-radius:5px;
  border:1px solid #ccc;
}

.consent-box {
  background:#f4f8f4;
  border:1px solid #cce3cc;
  padding:1rem;
  border-radius:5px;
  font-size:.95rem;
}

.checkbox-group {
  margin-top:1rem;
}

.submit-btn {
  width:100%;
  padding:1rem;
  margin-top:2rem;
  background:#4caf50;
  color:#fff;
  font-size:1.1rem;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

.submit-btn:hover {
  background:#3e8e41;
}

.status {
  text-align:center;
  font-weight:bold;
  margin-top:1rem;
}

.footer-note {
  text-align:center;
  font-size:.85rem;
  margin-top:1.5rem;
  color:#555;
}
</style>
</head>

<body>

<div class="form-container">

  <div class="form-header">
    <img src="https://github.com/colbyfuller50-cyber/PBS/blob/main/PBS%20Logo.png?raw=true">
    <h1>Background Check Authorization</h1>
    <p>Please upload a signed consent form.</p>
  </div>

  <div class="section-title">Applicant Information</div>

  <div class="form-group">
    <label>Full Legal Name</label>
    <input type="text" id="fullName" required>
  </div>

  <div class="form-group">
    <label>Email Address</label>
    <input type="email" id="email" required>
  </div>

  <div class="form-group">
    <label>Employer</label>
    <input type="text" id="employer" required>
  </div>

  <div class="section-title">Authorization</div>

  <div class="consent-box">
    By uploading this document, you confirm you have read and
    authorize Palmetto Background Screening to conduct a background check
    in compliance with the Fair Credit Reporting Act (FCRA).
  </div>

  <div class="checkbox-group">
    <label>
      <input type="checkbox" id="consentCheck" required>
      I authorize Palmetto Background Screening to conduct a background check.
    </label>
  </div>

  <div class="section-title">Upload Signed PDF</div>

  <div class="form-group">
    <label>Signed Consent Form (PDF Only)</label>
    <input type="file" id="pdfFile" accept="application/pdf" required>
  </div>

  <button class="submit-btn" onclick="uploadConsent()">Submit Authorization</button>

  <div class="status" id="statusMsg"></div>

  <div class="footer-note">
    © 2025 Palmetto Background Screening • FCRA Compliant
  </div>

</div>

<script>
const supabaseUrl = "https://snlhlitlenlqzabwaldg.supabase.co";
const supabaseKey = "sb_publishable_4tKa1p6b3bgSQpH8yTHIVg_X7Jmvk8b";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

async function uploadConsent() {
  const file = document.getElementById("pdfFile").files[0];
  const fullName = document.getElementById("fullName").value;
  const email = document.getElementById("email").value;
  const employer = document.getElementById("employer").value;
  const statusMsg = document.getElementById("statusMsg");

  if (!file) {
    statusMsg.textContent = "Please upload a PDF file.";
    return;
  }

  const filePath = `${Date.now()}_${file.name}`;

  const { error: uploadError } = await supabase.storage
    .from("consent-forms")
    .upload(filePath, file);

  if (uploadError) {
    statusMsg.textContent = uploadError.message;
    return;
  }

  const { error } = await supabase.from("consent_forms").insert({
    full_name: fullName,
    email: email,
    employer: employer,
    file_path: filePath
  });

  statusMsg.textContent = error
    ? error.message
    : "✅ Consent form successfully submitted.";
}
</script>

</body>
</html>
