<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palmetto Background Screening | Client Portal</title>
<link rel="stylesheet" href="style.css">
<style>
/* ===== Portal Styles ===== */
.portal-section {
    padding: 4rem 2rem;
    background-color: #f9f9f9;
    text-align: center;
}

.portal-section h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: #1b3b1b;
}

.portal-section p {
    margin-bottom: 3rem;
    font-size: 1.1rem;
    color: #333;
}

.portal-login, .portal-dashboard {
    background: #ffffff;
    border-radius: 10px;
    padding: 2rem;
    margin-bottom: 2rem;
    max-width: 450px;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    text-align: left;
}

.portal-login input, .portal-dashboard input {
    width: 100%;
    padding: 0.8rem;
    margin-bottom: 1rem;
    border-radius: 5px;
    border: 1px solid #ccc;
}

.portal-login button, .portal-dashboard button {
    width: 100%;
    padding: 1rem;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.status-item {
    border-bottom: 1px solid #ddd;
    padding: 0.5rem 0;
}
</style>
</head>
<body>

<header>
  <div class="container header-container">
    <a href="index.html">
      <img src="https://github.com/colbyfuller50-cyber/PBS/blob/main/PBS%20Logo.png?raw=true" alt="PBS Logo" class="logo">
    </a>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="portal.html">Client Portal</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <div class="hamburger" id="hamburger">
        <div></div>
        <div></div>
        <div></div>
      </div>
    </nav>
  </div>
</header>

<section class="portal-section">
  <h1>Client Portal</h1>
  <p>Log in to track your requests and securely submit documents.</p>

  <!-- Login / Signup Form -->
  <div class="portal-login" id="loginDiv">
    <h2>Login / Sign Up</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Sign Up</button>
    <p id="loginMsg"></p>
  </div>

  <!-- Dashboard -->
  <div class="portal-dashboard" id="dashboardDiv" style="display:none;">
    <h2>Welcome!</h2>
    <p>Upload your documents:</p>
    <input type="file" id="fileUpload">
    <button id="uploadBtn">Upload</button>
    <p id="uploadMsg"></p>
    <h3>Your Requests:</h3>
    <div id="statusList"></div>
    <button id="logoutBtn" style="background-color:#f44336;">Logout</button>
  </div>
</section>

<footer>
  <div class="container">
    <p>&copy; 2025 Palmetto Background Screening (PBS). All Rights Reserved.</p>
  </div>
</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>


<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

    // ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyBI_P0Hd5isXumpK3nWjrJMh3S6MpJRK50",
  authDomain: "palmetto-background-screening.firebaseapp.com",
  projectId: "palmetto-background-screening",
  storageBucket: "palmetto-background-screening.firebasestorage.app",
  messagingSenderId: "927961733452",
  appId: "1:927961733452:web:35d5f2b8882c0b181957e9"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// Elements
const loginDiv = document.getElementById('loginDiv');
const dashboardDiv = document.getElementById('dashboardDiv');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const loginMsg = document.getElementById('loginMsg');
const logoutBtn = document.getElementById('logoutBtn');
const uploadBtn = document.getElementById('uploadBtn');
const fileUpload = document.getElementById('fileUpload');
const uploadMsg = document.getElementById('uploadMsg');
const statusList = document.getElementById('statusList');

// ===== Auth Functions =====
signupBtn.addEventListener('click', () => {
  auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
    .then(() => { loginMsg.textContent = "Account created!"; })
    .catch(e => loginMsg.textContent = e.message);
});

loginBtn.addEventListener('click', () => {
  auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
    .catch(e => loginMsg.textContent = e.message);
});

logoutBtn.addEventListener('click', () => {
  auth.signOut();
});

// Auth state listener
auth.onAuthStateChanged(user => {
  if(user){
    loginDiv.style.display = 'none';
    dashboardDiv.style.display = 'block';
    loadRequests(user.uid);
  } else {
    loginDiv.style.display = 'block';
    dashboardDiv.style.display = 'none';
  }
});

// ===== Upload Function =====
uploadBtn.addEventListener('click', () => {
  const file = fileUpload.files[0];
  if(!file) return alert("Select a file!");
  const uploadTask = storage.ref('documents/' + auth.currentUser.uid + '/' + file.name).put(file);
  uploadTask.on('state_changed', null, error => {
    uploadMsg.textContent = error.message;
  }, () => {
    uploadMsg.textContent = "Upload successful!";
  });
});

// ===== Load Requests Function =====
function loadRequests(uid){
  statusList.innerHTML = "";
  db.collection("requests").where("uid","==",uid).get()
    .then(snapshot => {
      if(snapshot.empty){
        statusList.innerHTML = "<p>No requests yet.</p>";
      } else {
        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement('div');
          div.className = "status-item";
          div.textContent = `Request: ${data.type || "General"} | Status: ${data.status || "Pending"}`;
          statusList.appendChild(div);
        });
      }
    });
}
</script>
</body>
</html>

</script>
</body>
</html>
